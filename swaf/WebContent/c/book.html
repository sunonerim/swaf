<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Bootstrap Wizard by Creative Tim</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

	<link href="/m/css/gsdk-base.css" rel="stylesheet" />      
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet">
    
  	<style type="text/css">
  	.sbc-cal-row {
  		border-bottom: 1px solid #e1e1e1;
  		margin-left	: 0px;
  		margin-right: 0px;
  		width		: 100%;
  		height		: 2em;  		
  	}
  	.sbc-calendar-cell{
  	 	width   : 14.28%;
  	 	height  : 100%;
  	 	display : inline-block;
  	 	border-right: 1px solid #e1e1e1;
  	 }
  	 
  	 .sbc-calendar-cell-deactive{
  	 	color:#d0d0d0;
  	 }
  	 
  	 .sbc-timeband{
  	 	background-color:#d0d0d0;
  	 }
  	</style>
  	
</head>

<body>
<div class="image-container set-full-height" >
    
        <!--   Big container   -->
    <div class="container">
        <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
           
            <!--      Wizard container        -->   
            <div class="wizard-container"> 
                <form action="" method="">
                <div class="card wizard-card ct-wizard-green" id="wizard">
                
                <!--        You can switch "ct-wizard-azzure"  with one of the next bright colors: "ct-wizard-blue", "ct-wizard-green", "ct-wizard-orange", "ct-wizard-red"             -->
                
                    	<div class="wizard-header">
                        	<h3>
                        	   <b>BOOK</b> YOUR SEAT <br>
                        	   <small>This information will let us know more about your place.</small>
                        	</h3>
                    	</div>
                    	<ul>
                    		<li><a href="#sbi-time-step" 	data-toggle="tab">Time</a></li>
                            <li><a href="#location" 	data-toggle="tab">Service</a></li>
                            <li><a href="#sbi-asset-step"	data-toggle="tab">Designer</a></li>                            
                            <li><a href="#description" 	data-toggle="tab">Payment</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane" id="location">
                              <div class="row">
                                  <div class="col-sm-12">
                                    <h4 class="info-text"> Let's start with the basic details</h4>
                                  </div>
                                  
                                  <div class="col-sm-12">
                                       <div class="form-group">
                                       <label>Country</label><br>
                                       	<ul id="sb-service-pane"></ul>
									</div>
                                  </div>
                                  
                              </div>
                            </div>
                            
                            
                            <div class="tab-pane" id="sbi-asset-step">
                                <h4 class="info-text">What type of location do you have? </h4>
                                <div class="row">
                                    <div class="col-sm-10 col-sm-offset-1" id="sbi-asset-pane">
                                    </div>
                                </div>
                            </div>
                            
                            
                            <div class="tab-pane" id="sbi-time-step">
                                <h4 class="info-text">Select booking time </h4>
                                <div class="row">
                                    <div class="col-sm-5 col-sm-offset-1" id="sbi-cal-container"></div>
                                    <div class="col-sm-5" id="sbi-booktime-pane"></div> 
                                </div>
                            </div>
                            <div class="tab-pane" id="description">
                                <div class="row">
                                    <h4 class="info-text"> Drop us a small description. </h4>
                                    <div class="col-sm-6 col-sm-offset-1">
                                         <div class="form-group">
                                            <label>Place description</label>
                                            <textarea class="form-control" placeholder="" rows="9">
                                                
                                            </textarea>
                                          </div>
                                    </div>
                                    <div class="col-sm-4">
                                         <div class="form-group">
                                            <label>Example</label>
                                            <p class="description">"The place is really nice. We use it every sunday when we go fishing. It is so awesome."</p>
                                          </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wizard-footer">
                            	<div class="pull-right">
                                    <input type='button' class='btn btn-next btn-fill btn-success btn-wd btn-sm' name='next' value='Next' />
                                    <input type='button' class='btn btn-finish btn-fill btn-success btn-wd btn-sm' name='finish' value='Finish' />
        
                                </div>
                                <div class="pull-left">
                                    <input type='button' class='btn btn-previous btn-fill btn-default btn-wd btn-sm' name='previous' value='Previous' />
                                </div>
                                <div class="clearfix"></div>
                        </div>	
                </div>
                </form>
            </div> <!-- wizard container -->
        </div>
        </div> <!-- row -->
    </div> <!--  big container -->
   
    
    <!-- 
    <div class="fixed-plugin">
        <div class="dropdown open">
          <a href="#" data-toggle="dropdown"> 
            <i class="fa fa-cog fa-2x"> </i>
          </a>
          <ul class="dropdown-menu">
           <li>
                <a href="http://ct-freebies.herokuapp.com/wizard-demo-register">
                    <img src="images/thumb_register.png">
                     Register user flow
                </a>
            </li>
            <li>
                <a href="http://ct-freebies.herokuapp.com/wizard-demo-list-boat">
                    <img src="images/thumb_list_boat.png">
                     List your boat
                </a>
            </li>
            <li class="active">
                <a href="http://ct-freebies.herokuapp.com/wizard-demo-list-place">
                   <img src="images/thumb_list_place.png">
                   List your place
                </a>
            </li>
           <li>
                <a href="http://ct-freebies.herokuapp.com/wizard-components" target="_blank" class="btn btn-default btn-fill">How to use</a>
            </li>
            <li>
                <a href="http://www.creative-tim.com/product/wizard" target="_blank" class="btn btn-info btn-fill">Download, it's free!</a>
            </li>
            <li><a></a></li>
          </ul>
        </div>
     </div>
     
    -->
</div>

</body>
	<script type="text/javascript" charset="utf8" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		
	<!--   plugins 	 -->
	<script src="/m/js/jquery.bootstrap.wizard.js" type="text/javascript"></script>
	<script src="/m/js/wizard.js"></script>
	
	<script type="text/javascript">
	
	//**************************  data definition *****************************
	// 서비스는 예약시간에 영향을 주는 요소로ㅅ= 가장 먼저 선택된다. 
	// 비지니스의 종류에 따라서 서비스가 생략될 수 있다. 호텔의 경우 서비스는 생략된다. 
	var gServiceList = [ 
		{"serviceName":"Perma",    "servicePrice":"20"       ,"serviceTime": "1:30"}	// 1:30 means i hour and 30 mminutes
		,{"serviceName":"cut",     "servicePrice":"10"       ,"serviceTime": "1:00"}
		,{"serviceName":"dye",     "servicePrice":"100"       ,"serviceTime": "2:30"}
		,{"serviceName":"hair care", "servicePrice":"200"       ,"serviceTime": "3:00"}
	];
	
	var gAssetList = [ 
	            		{"name":"Terry Mcgil",     "picture":"http://demos.creative-tim.com/images/rotating_card_profile3.png"    ,"shortDescription": "Ultimate Hair Dresser"}
	            		,{"name":"Andrew Mike",     "picture":"http://demos.creative-tim.com/images/rotating_card_profile2.png"    ,"shortDescription": "Ultimate Hair Dresser"}
	            	];
	
	
	var	gAvailBookingTime = [	   	                     
				{ "assetID" : "carray" , "beginDateTime" : "201503300800" , "endDateTime" : "201503301200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201503301300" , "endDateTime" : "201503301800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504010800" , "endDateTime" : "201504011200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504011300" , "endDateTime" : "201504011800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504030800" , "endDateTime" : "201504031200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504060800" , "endDateTime" : "201504061200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504061300" , "endDateTime" : "201504061800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504081300" , "endDateTime" : "201504081800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504101100" , "endDateTime" : "201504101200" , "update:1.3" : 201504100800}
				,{ "assetID" : "carray" , "beginDateTime" : "201504130800" , "endDateTime" : "201504131000" , "update:2.2" : 201504131200}
				,{ "assetID" : "carray" , "beginDateTime" : "201504131300" , "endDateTime" : "201504131800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504150800" , "endDateTime" : "201504151000" , "update:2.1" : 201504151200}
				,{ "assetID" : "carray" , "beginDateTime" : "201504151300" , "endDateTime" : "201504151400" , "update:2.2" : 201504151800}
				,{ "assetID" : "carray" , "beginDateTime" : "201504200800" , "endDateTime" : "201504201200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504201300" , "endDateTime" : "201504201800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504220800" , "endDateTime" : "201504221200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504221300" , "endDateTime" : "201504221800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504240800" , "endDateTime" : "201504241200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504270800" , "endDateTime" : "201504271200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504271300" , "endDateTime" : "201504271800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504290800" , "endDateTime" : "201504291200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504291300" , "endDateTime" : "201504291800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201505010800" , "endDateTime" : "201505011200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201505040800" , "endDateTime" : "201505041200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201505041300" , "endDateTime" : "201505041800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201505060800" , "endDateTime" : "201505061200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201505061300" , "endDateTime" : "201505061800"}
				,{ "assetID" : "carray" , "beginDateTime" : "201505080800" , "endDateTime" : "201505081200"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504131100" , "endDateTime" : "201504131200" , "update:2.2" : "new"}
				,{ "assetID" : "carray" , "beginDateTime" : "201504151600" , "endDateTime" : "201504151800" , "update:2.2" : "new"}
              ];
	

	
	function	sbBuildServicePane() {
		for ( var i=0; i<gServiceList.length; i++){
			sbBuildServiceItem( gServiceList[i] );			
		}
	}
	
	function	sbBuildServiceItem( service ){
		$("#sb-service-pane").append("<li><input type='checkbox'>" 
									+ service.serviceName 
									+ "<span class='sbc-service-price'>"
									+ service.servicePrice + "</span>"
									+ "<span class='sbc-service-time'>"
									+ service.serviceTime + "</span></li>");
	}

/*
 * 부킹 가능 시간을 잡기 위한 인터페이스
 	gap : 시간 간격으로 1시간 간격인 경우 100, 30분 간격인경우 30, 15분 간격인 경우 10
 	
 */
	function	sbBuildBooktable(book_date, gap) {
		$("#sbi-booktime-pane").empty();
		
		//var	timeBands = ["0800", "0900", "1000", "1100", "1200", "1300", "1400", "1500", "1600", "1700"];
		var	timeBands = ["0800", "0830", "0900", "0930", "1000", "1030", "1100","1130", "1200",
		   	             "1230", "1300", "1330", "1400", "1430", "1500", "1530", "1600", "1630", "1700", "1730"];
		
		for ( var i=0; i<timeBands.length; i++){
			$("#sbi-booktime-pane").append("<div id='sbi-booking-time-band-" + timeBands[i] + "' class='sbc-timeband'>"  + timeBands[i] + "</div>")
		}
		
		
		var	book_ymd = formatYYYYMMDD(book_date);
		for ( var i=0; i<gAvailBookingTime.length; i++){
			if( gAvailBookingTime[i].beginDateTime.substring(0,8) == book_ymd ){
				// 
				var begin_time = gAvailBookingTime[i].beginDateTime.substring(8,12);
				var end_time   = gAvailBookingTime[i].endDateTime.substring(8,12);
				
				for ( var k=0; k<timeBands.length; k++){
					if(  begin_time<= timeBands[k] && timeBands[k] < end_time ){
						$("#sbi-booking-time-band-"+  timeBands[k] ).css({"background-color":"yellow" });	
					} // else
						//$("#sbi-booking-time-band-"+  timeBands[k] ).css({"background-color":"gray" });
				}
			}
		}
	}
	
	function	sbBuildAssetPane() {
		for ( var i=0; i<gAssetList.length; i++){
			sbBuildAssetItem( gAssetList[i] );			
		}
	}
	
	function	sbBuildAssetItem( asset ){
		
		var child_num = $("#sbi-asset-pane").children().length;
		
		if( child_num % 2 == 0 )
		$("#sbi-asset-pane").append(" <div class='col-sm-4 col-sm-offset-2'><span class='sbc-asset-name'>" 
									+ asset.name
									+ "</span>"
									+ "<img  class='img-circle' src='"  + asset.picture + "'  style='width:100px;'>"
									+ "<span class='sbc-asset-short'>" + asset.shortDescription + "</span></div>");
		else 
		$("#sbi-asset-pane").append(" <div class='col-sm-4'><span class='sbc-asset-name'>" 
				+ asset.name
				+ "</span>"
				+ "<img  class='img-circle' src='"  + asset.picture + "' style='width:100px;'>"
				+ "<span class='sbc-asset-short'>" + asset.shortDescription + "</span></div>");
		
	}
	
	

	/*
		부킹이 가능한지를 얄려 줌		
		book_date : 
	*/
	function	canBook( book_date, asset_id, howmuch, avail_booking){
		console.log("#########################" + book_date)
		
		var	book_ymd = formatYYYYMMDD(book_date);
		for ( var i=0; i<avail_booking.length; i++){
			//if( book_ymd == avail_booking[i].date && avail_booking[i].assetID == asset_id ){
			if( avail_booking[i].assetID == asset_id && avail_booking[i].beginDateTime.substring(0,8) == book_ymd ){
								
				// 중간에 빈 곳이howmuch가 요구한 수준의 시간이 되는지을 확인한다 
				var howmuch_end_time = book_ymd + computeEndTime( avail_booking[i].beginDateTime.substring(8), howmuch);
				
				console.log("howmuch_end_time>" + howmuch_end_time );
				
				if ( avail_booking[i].endDateTime >= howmuch_end_time) {
					console.log("OK>" + avail_booking[i]);
					console.log(avail_booking[i]);
					return true;
				}
			}
		}
		console.log("NOPE")
		return false;
	}
	
	function	computeEndTime(begin_time, howmuch){
		var	i_begin_time = new Number(begin_time );
		var i_hour = Math.floor(i_begin_time / 100);
		var i_min  = i_begin_time % 100;
		
		var i_howmuch = new Number(howmuch);
		var i_how_hour = Math.floor(i_howmuch / 100);
		var i_how_min  = i_howmuch % 100;

        //console.log(i_min);
		i_hour += i_how_hour;
		
		i_min += i_how_min;
 		//console.log(i_min);
		if( i_min >= 60 ){
          //console.log("60 less");
			i_hour += 1;
			i_min -= 60;
		}		
		var end_time = i_hour*100 + i_min;
		
		return  end_time < 1000 ? "0" + end_time : ""+end_time;
	}
	
	function	formatYYYYMMDD(date){
		var mm = date.getMonth()+1;
		var dd = date.getDate();
	
		var	ymd = "" + date.getFullYear() 
                + (mm+1 < 10 ? "0"+mm:mm )
				+ (dd<10 ? "0"+dd:dd)	;	        
		return ymd;
	}
	
	//******************************************************
	// Calendar Logic 
	//******************************************************
	
	// 현재 Month의 일자별 달력, 그리고 예약 가능시 글자를 더 드라지게 하고 클릭이 가능하도록 한다.		

	// calendar 를 처리하는 로직
	function	sbDrawCalendar( year,month) {
		var first_day = new Date(year, month, 1, 0,0,0,0);
		console.log( "first_day.getDay():" + first_day.getDay()) ;	
	}
	
	function	sbCalendar(cal_container){
		this.CalContainer	= cal_container;		// 칼렌다가 표시되는 영역
		this.Year = null ;
		this.Month = null;
		this.drawCellHandler = null;
		
		this.initCalendar = function() {
			this.drawCalHeader();
			for ( i=0; i<6; i++) this.drawWeekFrame();
			
			$('.sbc-calendar-cell').click(function(){
				sbBuildBooktable( $(this).data("cell-date") );
			});
		}
	
		this.drawCalHeader= function() {			
			$("<div class='sbc-cal-header'>").appendTo(this.CalContainer )
				.append("<div class='sbc-calendar-cell'>SUN</div>")
				.append("<div class='sbc-calendar-cell'>MON</div>")
				.append("<div class='sbc-calendar-cell'>TUE</div>")
				.append("<div class='sbc-calendar-cell'>WED</div>")
				.append("<div class='sbc-calendar-cell'>THU</div>")
				.append("<div class='sbc-calendar-cell'>FRI</div>")
				.append("<div class='sbc-calendar-cell'>SAT</div>");
         	
		}
		
		this.drawWeekFrame = function() {
			$("<div class='sbc-cal-row'>").appendTo(this.CalContainer )
				.append("<div class='sbc-calendar-cell'></div>")
				.append("<div class='sbc-calendar-cell'></div>")
				.append("<div class='sbc-calendar-cell'></div>")
				.append("<div class='sbc-calendar-cell'></div>")
				.append("<div class='sbc-calendar-cell'></div>")
				.append("<div class='sbc-calendar-cell'></div>")
				.append("<div class='sbc-calendar-cell'></div>");
		}
				
		
		this.formatYYYYMMDD = function(date){
			  
			var mm = date.getMonth()+1;
			var dd = date.getDate();
		
			var	ymd = "" + date.getFullYear() 
	                + (mm+1 < 10 ? "0"+mm:mm )
					+ (dd<10 ? "0"+dd:dd)	;	        
			return ymd;
		}
		
		this.makeDateArrayOfMonth = function(year, month){
			var	monthDate = new Array();
			var mon = month - 1  // (1)
			var d = new Date(year, mon);
			
			var	day = d.getDay();
			d.setDate( d.getDate() - day );
			for (var i=0; i<42; i++) {								
				//monthDate[i] = this.formatYYYYMMDD(d);
				var	cell_date = new Object();
				cell_date["date"] = d.getDate();
				cell_date["ymd"]  = new Date(d);//d.toString();//this.formatYYYYMMDD(d);
				
				monthDate[i] = cell_date;
				d.setDate( d.getDate() + 1 );
			}
			return monthDate;
		}
		
		/**
			칼렌다의 날짜를 입력한다. 
			날자 입력시 drawCellHandler()를 호출하여 application에서 의도하는데로 셀의 내용물을 교체할 수 있다.		
		*/
		this.drawMonth = function(year, month) {
			var	dateArray = this.makeDateArrayOfMonth(year, month);
						
			var	index = 0;
			var	handler = this.drawCellHandler;
			
			$(".sbc-cal-row .sbc-calendar-cell").each(function(){
				$(this).html( dateArray[index]["date"]);
				$(this).data("cell-date", dateArray[index]["ymd"]);				
				if( handler != null ) handler($(this), dateArray[index]["ymd"] );
				index++;
			});	
		}
		
		this.build= function(year, month){
			this.Year = year;
			this.Month = month;
			this.drawMonth(year, month);
		}
		
	}
	
	
	
	var	gCal = new sbCalendar("#sbi-cal-container");
	
	$(document).ready(function(){
		sbBuildServicePane();
		sbBuildAssetPane();
		gCal.initCalendar();
		gCal.drawCellHandler = function($cell){ 
			var book_date = $cell.data("cell-date");
			//console.log("YMD>" + $cell.data("cell-date").getFullYear() );
			if( canBook( book_date, "carray", "0300", gAvailBookingTime)){
				$cell.append("<span>canBOOK</span>");				
			} else {
				$cell.addClass("sbc-calendar-cell-deactive")
			}
		};		
		gCal.build(2015,4);
		
		// test 
		canBook( new Date(2015,3,6), "carray", "0200", gAvailBookingTime);
		
		
	});
	
	
	</script>
</html>